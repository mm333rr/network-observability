{
  "title": "\ud83c\udfac Plex Media Server",
  "uid": "capes-plex",
  "tags": [
    "plex",
    "capes"
  ],
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "refresh": "30s",
  "panels": [
    {
      "type": "text",
      "id": 1,
      "title": "\ud83c\udfac Plex Media Server",
      "gridPos": {
        "h": 3,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "options": {
        "mode": "markdown",
        "content": "## \ud83c\udfac Plex Media Server \u2014 The Capes \u00b7 macpro \u00b7 192.168.1.30\nStream counts \u00b7 transcoding \u00b7 client breakdown \u00b7 logs \u00b7 errors\n\n[\u2190 Home](/d/capes-home) \u00b7 [Telegraf System](/d/telegraf-macpro-system) \u00b7 [Plex Web](http://localhost:32400/web)"
      }
    },
    {
      "type": "row",
      "id": 10,
      "title": "\ud83d\udfe2 Status",
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 3
      }
    },
    {
      "type": "stat",
      "id": 11,
      "title": "Plex Server",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 0,
        "y": 4
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "green",
                "value": 1
              }
            ]
          },
          "mappings": [
            {
              "type": "value",
              "options": {
                "0": {
                  "text": "\ud83d\udd34  DOWN",
                  "color": "red"
                },
                "1": {
                  "text": "\ud83d\udfe2  UP",
                  "color": "green"
                }
              }
            }
          ]
        }
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "colorMode": "background",
        "graphMode": "none",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "plex_up{host=\"macpro\"}",
          "legendFormat": "Plex Server",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "stat",
      "id": 12,
      "title": "Active Streams",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 4,
        "y": 4
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 3
              },
              {
                "color": "red",
                "value": 6
              }
            ]
          }
        }
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "colorMode": "background",
        "graphMode": "none",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "plex_active_streams{host=\"macpro\"}",
          "legendFormat": "Active Streams",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "stat",
      "id": 13,
      "title": "Direct Play",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 8,
        "y": 4
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        }
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "colorMode": "background",
        "graphMode": "none",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "plex_direct_streams{host=\"macpro\"}",
          "legendFormat": "Direct Play",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "stat",
      "id": 14,
      "title": "Transcoding",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 12,
        "y": 4
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 1
              },
              {
                "color": "red",
                "value": 3
              }
            ]
          }
        }
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "colorMode": "background",
        "graphMode": "none",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "plex_transcoding_streams{host=\"macpro\"}",
          "legendFormat": "Transcoding",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "stat",
      "id": 15,
      "title": "Errors (5m)",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 16,
        "y": 4
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 1
              },
              {
                "color": "red",
                "value": 5
              }
            ]
          }
        }
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "colorMode": "background",
        "graphMode": "none",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "count_over_time({job=\"plex\",level=\"ERROR\"}[5m])",
          "legendFormat": "Errors (5m)",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "stat",
      "id": 16,
      "title": "Warnings (5m)",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 20,
        "y": 4
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 5
              }
            ]
          }
        }
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "colorMode": "background",
        "graphMode": "none"
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "count_over_time({job=\"plex\",level=\"WARN\"}[5m])",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "row",
      "id": 20,
      "title": "\ud83d\udcca Stream Activity",
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 9
      }
    },
    {
      "type": "timeseries",
      "id": 21,
      "title": "Active Streams Over Time",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "fillOpacity": 30,
            "lineWidth": 2,
            "stacking": {
              "mode": "value"
            }
          }
        }
      },
      "options": {
        "tooltip": {
          "mode": "multi"
        },
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "plex_active_streams{host=\"macpro\"}",
          "legendFormat": "Total",
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "plex_direct_streams{host=\"macpro\"}",
          "legendFormat": "Direct Play",
          "refId": "B"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "plex_transcoding_streams{host=\"macpro\"}",
          "legendFormat": "Transcoding",
          "refId": "C"
        }
      ]
    },
    {
      "type": "timeseries",
      "id": 22,
      "title": "Stream Bitrate (kbps)",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "kbytes",
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "fillOpacity": 30,
            "lineWidth": 2,
            "stacking": {
              "mode": "none"
            }
          }
        }
      },
      "options": {
        "tooltip": {
          "mode": "multi"
        },
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum(plex_stream_bitrate_kbps{host=\"macpro\"})",
          "legendFormat": "Total kbps",
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum by(decision)(plex_stream_bitrate_kbps{host=\"macpro\"})",
          "legendFormat": "{{decision}}",
          "refId": "B"
        }
      ]
    },
    {
      "type": "row",
      "id": 30,
      "title": "\ud83d\udcf1 Client Breakdown",
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 19
      }
    },
    {
      "type": "bargauge",
      "id": 31,
      "title": "Streams by Platform",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 20
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        }
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "showUnfilled": true
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum by(platform)(plex_stream_info{host=\"macpro\"})",
          "legendFormat": "{{platform}}",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "bargauge",
      "id": 32,
      "title": "Streams by Device",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 20
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        }
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "showUnfilled": true
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum by(device)(plex_stream_info{host=\"macpro\"})",
          "legendFormat": "{{device}}",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "bargauge",
      "id": 33,
      "title": "Streams by User",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 20
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        }
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "showUnfilled": true
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum by(user)(plex_stream_info{host=\"macpro\"})",
          "legendFormat": "{{user}}",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "bargauge",
      "id": 34,
      "title": "Streams by Media Type",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 29
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        }
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "showUnfilled": true
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum by(media_type)(plex_stream_info{host=\"macpro\"})",
          "legendFormat": "{{media_type}}",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "bargauge",
      "id": 35,
      "title": "Streams by Resolution",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 29
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        }
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "showUnfilled": true
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum by(video_resolution)(plex_stream_info{host=\"macpro\"})",
          "legendFormat": "{{video_resolution}}",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "bargauge",
      "id": 36,
      "title": "Streams by Decision",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 29
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        }
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "showUnfilled": true
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum by(decision)(plex_stream_info{host=\"macpro\"})",
          "legendFormat": "{{decision}}",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "type": "row",
      "id": 40,
      "title": "\ud83d\udcda Libraries",
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 38
      }
    },
    {
      "type": "table",
      "id": 41,
      "title": "Library Sections",
      "gridPos": {
        "h": 5,
        "w": 12,
        "x": 0,
        "y": 39
      },
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "left"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Value"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Status"
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "type": "value",
                    "options": {
                      "1": {
                        "text": "\u2705 Active"
                      }
                    }
                  }
                ]
              }
            ]
          }
        ]
      },
      "options": {
        "showHeader": true
      },
      "transformations": [
        {
          "id": "labelsToFields",
          "options": {
            "mode": "columns"
          }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Time": true,
              "__name__": true,
              "host": true
            },
            "renameByName": {}
          }
        }
      ],
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "plex_library_section{host=\"macpro\"}",
          "instant": true,
          "format": "table",
          "refId": "A"
        }
      ]
    },
    {
      "type": "row",
      "id": 50,
      "title": "\ud83d\udccb Logs",
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 45
      }
    },
    {
      "type": "logs",
      "id": 51,
      "title": "Plex Errors & Warnings",
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 46
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "showTime": true,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "sortOrder": "Descending"
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "{job=\"plex\", level=~\"ERROR|WARN\"}",
          "refId": "A"
        }
      ]
    },
    {
      "type": "logs",
      "id": 52,
      "title": "Plex Requests (non-poll)",
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 55
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "showTime": true,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "sortOrder": "Descending"
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "{job=\"plex\", plex_event=\"request\"} |~ \"Request:\" !~ \"status/sessions\"",
          "refId": "A"
        }
      ]
    },
    {
      "type": "logs",
      "id": 53,
      "title": "Scanner / Metadata Agent",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 64
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "showTime": true,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "sortOrder": "Descending"
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "{job=~\"plex|plex-scanner\"} |~ \"scanner|MetadataAgent|ERROR\"",
          "refId": "A"
        }
      ]
    },
    {
      "type": "logs",
      "id": 54,
      "title": "Transcoder",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 64
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "showTime": true,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "sortOrder": "Descending"
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "{job=~\"plex|plex-transcoder\"} |~ \"ranscode|transcode\"",
          "refId": "A"
        }
      ]
    },
    {
      "type": "logs",
      "id": 55,
      "title": "All Plex Logs (live tail)",
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 73
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "showTime": true,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "sortOrder": "Descending"
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "{job=~\"plex.*\"}",
          "refId": "A"
        }
      ]
    }
  ]
}