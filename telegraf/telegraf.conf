[global_tags]
  location = "capes-ventura"
  environment = "homelab"

[agent]
  interval = "30s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "5s"
  flush_interval = "30s"
  flush_jitter = "5s"
  precision = ""
  hostname = "macpro"
  omit_hostname = false

# Output: expose as Prometheus metrics for Prometheus to scrape
[[outputs.prometheus_client]]
  listen = ":9273"
  metric_version = 2
  expiration_interval = "60s"

# Collect host CPU metrics
[[inputs.cpu]]
  percpu = true
  totalcpu = true
  collect_cpu_time = false
  report_active = false

# Collect host memory metrics
[[inputs.mem]]

# NOTE: disk, diskio, net, system collectors require Linux /proc
# and are not available in macOS Docker. Host metrics are covered
# by Node Exporter (port 9100) which runs with host PID namespace.

# ---------------------------------------------------------------------------
# EXEC INPUTS — macOS native metric scripts mounted into container
# Scripts live in ./scripts/, mounted to /scripts/ inside container.
# Container image must be telegraf:1.29 (Debian) for bash + curl.
# Plex script uses host.docker.internal to reach Plex on the Mac host.
# ---------------------------------------------------------------------------

# Disk usage — host-side metrics file written by LaunchAgent every 30s
# (Docker cannot see individual macOS APFS volumes via df; host writes the file)
[[inputs.file]]
  files = ["/host-metrics/disk_metrics.prom", "/host-metrics/smart_metrics.prom"]
  data_format = "prometheus"

# SMART drive health and temperature
[[inputs.exec]]
  commands = ["/scripts/smart_metrics.sh"]
  timeout = "30s"
  interval = "5m"
  data_format = "prometheus"

# SMB share session counts and auth failures
[[inputs.exec]]
  commands = ["/scripts/smb_metrics.sh"]
  timeout = "15s"
  interval = "60s"
  data_format = "prometheus"

# Security events: SSH, console login, sudo, screen lock, auth failures
[[inputs.exec]]
  commands = ["/scripts/security_metrics.sh"]
  timeout = "20s"
  interval = "60s"
  data_format = "prometheus"

# Plex active streams
[[inputs.exec]]
  commands = ["/scripts/plex_metrics.sh"]
  timeout = "10s"
  interval = "30s"
  data_format = "prometheus"
  environment = ["PLEX_TOKEN=XDMas6E2Nq7-MCGkeeDE"]

# ---------------------------------------------------------------------------
# SNMP — Network device polling
# Replace 192.168.1.1 with your actual router/switch IP(s)
# Default community string is "public" — change if you've configured otherwise
# ---------------------------------------------------------------------------
[[inputs.snmp]]
  agents = ["udp://192.168.1.1:161"]
  timeout = "5s"
  retries = 3
  version = 2
  community = "public"
  name = "router"

  # System uptime — numeric OID (no MIB files required in container)
  [[inputs.snmp.field]]
    name = "uptime"
    oid = ".1.3.6.1.2.1.1.3.0"

  # System name
  [[inputs.snmp.field]]
    name = "sysName"
    oid = ".1.3.6.1.2.1.1.5.0"

  # Interface table — numeric OIDs from IF-MIB (RFC 2863)
  [[inputs.snmp.table]]
    name = "interface"
    inherit_tags = ["sysName"]
    [[inputs.snmp.table.field]]
      name = "ifDescr"
      oid = ".1.3.6.1.2.1.2.2.1.2"
      is_tag = true
    [[inputs.snmp.table.field]]
      name = "ifInOctets"
      oid = ".1.3.6.1.2.1.2.2.1.10"
    [[inputs.snmp.table.field]]
      name = "ifOutOctets"
      oid = ".1.3.6.1.2.1.2.2.1.16"
    [[inputs.snmp.table.field]]
      name = "ifInErrors"
      oid = ".1.3.6.1.2.1.2.2.1.14"
    [[inputs.snmp.table.field]]
      name = "ifOutErrors"
      oid = ".1.3.6.1.2.1.2.2.1.20"
    [[inputs.snmp.table.field]]
      name = "ifOperStatus"
      oid = ".1.3.6.1.2.1.2.2.1.8"

# Add more SNMP agents for switches or APs:
# [[inputs.snmp]]
#   agents = ["udp://192.168.1.2:161"]
#   community = "public"
#   name = "switch"
#   ...
